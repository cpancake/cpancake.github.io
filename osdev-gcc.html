<!DOCTYPE html>
<html lang="en">
<head>
          <title>the andrew rogers webzone</title>
        <meta charset="utf-8" />
        <link href='//fonts.googleapis.com/css?family=Montserrat:700|Roboto+Condensed:400italic,400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css?698b47d4">
        <link rel="stylesheet" href="/theme/css/style.min.css?bd02deb6">



    <meta name="tags" contents="programming" />
    <meta name="tags" contents="osdev" />

</head>

<body id="index" class="home">
    <header id="banner" class="body">
            <h1><a class="uilink" href="/">the andrew rogers webzone <strong></strong></a></h1>
    </header><!-- /#banner -->
    <nav id="menu">
        <ul>
            <li><a class="uilink" href="/">Home</a></li>
            <li><a class="uilink" href="/portfolio/">Portfolio</a></li>
            <li><a class="uilink" href="https://twitter.com/_cpancake">Twitter</a></li>
        </ul>
    </nav><!-- /#menu -->
    <div class="container main-container">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">Cross-compiling GCC for OS Development</h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-05-22T17:47:00-04:00">Thu 22 May 2014</abbr>
    <address class="vcard author">
      by           <a class="url fn" href="/author/andrew-rogers.html">Andrew Rogers</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p><strong>This series has been discontinued in favor of the far superior <a href="http://littleosbook.github.io/">Little OS Book</a>. Take a look at that one if you want to develop an operating system!</strong></p>
<p>I'm going to be writing some articles about operating system development, because it seems that most of the tutorials available are either outdated or incomplete. For the first part, I'm going to be going over how to compile your OS. This was adapted from the <a href="http://wiki.osdev.org/GCC_Cross-Compiler">osdev.org</a> guide.</p>
<p>To compile an operating system, a linker is needed. The usual choice for this is GCC's linker, but it needs some work before you can use it for operating system development. That's because GCC, by default, compiles for the native operating system (Windows EXEs on Windows, Linux ELF files on Linux). To compile operating systems, we must recompile GCC for platform-less ELF files, like a kernel. This is simple, but it takes a while.</p>
<h2>Preparation</h2>
<p>First, if you're on Windows, you need to install Cygwin. It's likely possible to build GCC on normal Windows, but it's much easier to do it on Cygwin. <a href="https://cygwin.com/install.html">Download</a> and install Cygwin, and stop at the package installation screen. Make sure you install these packages:</p>
<ul>
<li>gcc-core</li>
<li>gcc-g++</li>
<li>make</li>
<li>bison</li>
<li>flex</li>
<li>gmp and libgmp-devel</li>
<li>mpfr and libmpfr-devel</li>
<li>mpclib and libmpc-devel</li>
</ul>
<p>Next, you'll need to download the GCC sources. Download binutils <a href="http://ftp.gnu.org/gnu/binutils/binutils-2.24.tar.gz">here</a>, and gcc <a href="http://ftp.gnu.org/gnu/gcc/gcc-4.9.0/gcc-4.9.0.tar.gz">here</a>. Extract them to your Cygwin home folder (mine is <code>C:\cygwin64\home\Andrew</code>, though you'll need to start up Cygwin once to create this directory). </p>
<h2>Compiling</h2>
<p>After you've installed Cygwin and downloaded the sources, <code>cd</code> to your home directory. Then, you'll need to setup some environment variables:</p>
<div class="highlight"><pre><span class="nb">export </span><span class="nv">PREFIX</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/opt/cross&quot;</span>
<span class="nb">export </span><span class="nv">TARGET</span><span class="o">=</span>i386-elf
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PREFIX</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</pre></div>


<p><code>PREFIX</code> defines the location that the compiled binaries will be installed. <code>TARGET</code> defines the platform that you want to compile for - in this case, 32-bit ELF. We also add the installation directory to the <code>PATH</code>, so that the compiled libraries will be available when we compile gcc.</p>
<h2>binutils</h2>
<p>First, we make a directory to install binutils into:</p>
<div class="highlight"><pre>mkdir build
<span class="nb">cd </span>build
</pre></div>


<p>Then, we configure binutils.</p>
<div class="highlight"><pre>../binutils-2.24/configure --target<span class="o">=</span><span class="nv">$TARGET</span> --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PREFIX</span><span class="s2">&quot;</span> --disable-nls --disable-werror
</pre></div>


<p>This should create a <code>Makefile</code>. If it doesn't, leave a comment with the error or ask on StackOverflow.</p>
<p>Next, we should compile and install binutils:</p>
<div class="highlight"><pre>make
make install
</pre></div>


<p>Finally, clear the build directory so we can use it for GCC:</p>
<div class="highlight"><pre>rm -rf *
</pre></div>


<h2>gcc</h2>
<p>Configure gcc the same way:</p>
<div class="highlight"><pre>../gcc-4.9.0/configure --target<span class="o">=</span><span class="nv">$TARGET</span> --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PREFIX</span><span class="s2">&quot;</span> --disable-nls --enable-languages<span class="o">=</span>c,c++ --without-headers
</pre></div>


<p>Then, we build gcc:</p>
<div class="highlight"><pre>make all-gcc
make all-target-libgcc
make install-gcc
make install-target-libgcc
</pre></div>


<p>You now have a cross-compiled GCC build. The binaries are in <code>~/opt/cross</code>, which you can add to your Windows path so that you can use it without prefixing it with the directory.</p>
<p>Next post I'll be covering how to setup an OS development environment and compile a simple kernel using GRUB.</p>
  </div><!-- /.entry-content -->
</section>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'commiesprogblog'; 
    var disqus_title = 'Cross-compiling GCC for OS Development';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
    <footer id="contentinfo" class="body container">
        <address id="about" class="vcard body">
            <p>
                Written by <span class="fn">Andrew Rogers</span> (<span class="nickname">cpancake</span>) - contact me at <span class="email">andrew@<span class="email-obscure">lame-spam-bots-</span><span class="email-dont-obscure">anime-nigh</span>t.com</span>
            </p>
            <p>
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
            </p>
        </address><!-- /#about -->
    </footer><!-- /#contentinfo -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-51284727-1', 'cpancake.github.io');
        ga('send', 'pageview');
    </script>
</body>
</html>