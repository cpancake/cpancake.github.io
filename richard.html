<!DOCTYPE html>
<html lang="en">
<head>
          <title>Richard 1.0 - Rant's New Scripting Engine - the andrew rogers webzone</title>
        <meta charset="utf-8" />
        <link href='//fonts.googleapis.com/css?family=Montserrat:700|Roboto+Condensed:400italic,400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css?698b47d4">
        <link rel="stylesheet" href="/theme/css/style.min.css?bd02deb6">



    <meta name="tags" contents="programming" />
    <meta name="tags" contents="rant" />

</head>

<body id="index" class="home">
    <header id="banner" class="body">
            <h1><a class="uilink" href="/">the andrew rogers webzone <strong></strong></a></h1>
    </header><!-- /#banner -->
    <nav id="menu">
        <ul>
            <li><a class="uilink" href="/">Home</a></li>
            <li><a class="uilink" href="/portfolio/">Portfolio</a></li>
            <li><a class="uilink" href="https://twitter.com/_cpancake">Twitter</a></li>
        </ul>
    </nav><!-- /#menu -->
    <div class="container main-container">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">Richard 1.0 - Rant's New Scripting Engine</h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2015-06-25T20:56:00-04:00">Thu 25 June 2015</abbr>
    <address class="vcard author">
      by           <a class="url fn" href="/author/andrew-rogers.html">Andrew Rogers</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Rant 2.0 is almost here, and it launches with a new scripting language I wrote called Richard! We're still ironing out the bugs and writing the documentation and the standard library, but here's a post describing most of what Richard is about.</p>
<h2>The History of Richard</h2>
<p>Let's look back to Rant 1.0, all those months ago. Rant 1.0 had a syntax for simple arithmetic operations. This supported basic math operations as well as variables. A simple arithmetic expression would look like this:</p>
<div class="highlight"><pre>`a = 10; a += 5; a` # 15
</pre></div>


<p>Though it served its purpose well, it lacked many features. The only variable type was a number type (double), and any kind of control flow wasn't possible. The <a href="https://github.com/TheBerkin/Rant/tree/2222c119d08235abd611de81427605230c0fb9b4/Rant/Engine/Arithmetic">arithmetic parser</a> itself wasn't well integrated with the rest of Rant, using a different lexer and "VM" than the rest of Rant.</p>
<p>The new scripting system was originally divided into separate issues: <a href="https://github.com/TheBerkin/Rant/issues/40">we needed to add a string type to the arithmetic system</a>, we needed to integrate the variable system with all the other types of variables (carriers and subroutines), and we needed to integrate the parser with the rest of Rant. We eventually realized that we would be better off just redesigning the language itself, leading to <a href="https://github.com/TheBerkin/Rant/issues/46">the idea of a new language inside of Rant called Rave</a>.</p>
<p>Originally, <a href="https://github.com/TheBerkin/Rant/issues/49">Rave was going to compile into bytecode</a> similar to IL, which would run on a VM within Rant. However, <a href="https://github.com/TheBerkin/Rant/pull/54">Berkin figured out a way to restructure the Rant parser and VM to remove recursion</a>, and we decided that using this system for Rave would be best. At some point Berkin decided to use Rave as the name of <a href="https://github.com/TheBerkin/Rant/tree/dev/Rave">the Rant command line utility for dictionaries</a>, and so the scripting engine was renamed Richard, for completely mature reasons.</p>
<p>After a lot of hard work and spaghetti code, Richard was committed in <a href="https://github.com/TheBerkin/Rant/commit/901be7f109701df7711586338d6b94e9d39f17e5">901be7f</a>. We're still working out the bugs and adding some new features.</p>
<h2>The Basics</h2>
<p>Richard is pretty similar to Javascript, if Javascript was smaller, less featureful, and written by someone who had never written a programming language before. It runs within Rant, and is contained within a [@ ... ] tag:</p>
<div class="highlight"><pre>[@ 2 + 2 ]
</pre></div>


<p>Richard has variables - obviously - of which there are two syntaxes. The regular <code>name = value;</code> syntax works, and will create the variable in the current scope. There is also a <code>var name = value;</code> or just <code>var name;</code> syntax, which will create the variable in the current scope whether or not a value is given.</p>
<p>There are nine basic types in Richard:</p>
<ul>
<li>
<p>number</p>
</li>
<li>
<p>string</p>
</li>
<li>
<p>bool</p>
</li>
<li>
<p>list</p>
</li>
<li>
<p>object</p>
</li>
<li>
<p>function</p>
</li>
<li>
<p>pattern string</p>
</li>
<li>
<p>no</p>
</li>
<li>
<p>undefined</p>
</li>
</ul>
<p>And what are all of these sweet types?</p>
<ul>
<li>
<p><strong>number</strong> types are internally represented as a double (i.e. a 64-bit double-precision number). Basic infix operations are supported - <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code> - as well as groups - <code>(2 + 2) / 2</code>. Order of operations applies, of course. There are assignment versions of those as well - <code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, and <code>%=</code>.</p>
</li>
<li>
<p><strong>string</strong> types are .NET strings internally, which means I think they support Unicode. I'm not entirely sure. They are delimited by double quotes - single quotes not supported. There is a length property, accessible through the same way as any other object property - <code>"string".length</code> or <code>"string"["length"]</code>. You can also use an array indexer if you want to get a certain character of a string i.e. <code>"string"[2] # "r"</code>. String concatenation is done using a special operator Ã  la D. That is, the operator is <code>~</code>. It will cast whatever is on the right side of it to a string if it isn't already a string, but the left side must be either a string or a pattern string. There is also an assignment version - <code>~=</code>.</p>
</li>
<li>
<p><strong>bool</strong> types are just simple booleans. <code>true</code> or <code>false</code>, you know the deal. There are a few boolean operators which return bool values. You probably know these from other languages: <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, and <code>!</code>.</p>
</li>
<li>
<p><strong>list</strong> types are lists of objects. There are three ways of defining them: a bare list syntax, using just commas - <code>x = 1, 2, 3, 4, 5;</code>, a bracket syntax like in Javascript - <code>x = [1, 2, 3, 4, 5]</code>, and a list initializer for creating empty lists of a certain length - <code>x = list 12;</code>. When using the bare list syntax, any variables specified within that are lists will be expanded - that is, you can use the bare list syntax to concat two lists together: <code>x = 1, 2; y = 3, 4, 5; z = x, y;</code>. If you don't want this, you can use the bracket syntax. You should also use the bracket syntax for creating a list of lists, or for passing lists as an argument to function calls, or for creating lists inside of object literals. You can access a list's length using the <code>length</code> property: <code>x = 1, 2, 3, 4, 5; x.length # 5</code>. If a list is returned from an expression (it's the last value evaluated, or it's explicitly returned using a return statement), it will be executed as a block in Rant.</p>
</li>
<li>
<p><strong>object</strong> types are key/value objects, like in Javascript. And similarly to Javascript, the syntax is JSON. <em>Not</em> Javascript object syntax, but JSON. That means all key names must be either strings or just bare text (i.e. <code>{test: 2}</code>). You can access an object's property via dot syntax (<code>{"test":2}.test</code>) or via bracket accessor syntax (<code>{"test":2}["test"]</code>). You can also set object properties the same way i.e. <code>x = {"test":2}; x.test = 3; x["test"] = 4</code>.</p>
</li>
<li>
<p><strong>function</strong> types are, well, functions. There are two ways to define them: using a C-like syntax - <code>x = function(a, b) { a + b };</code> - or using a lambda syntax - <code>x = (a, b) =&gt; a + b;</code> Function calls are the same as every other language: <code>x(2, 3)</code>. You can return things from them using a <code>return</code> statement, just like every other language, though it'll return the last value evaluated in the function if there's no return statement. You can also <code>return</code> from any other statement in Richard, which will end the expression and return the value to the Rant pattern.</p>
</li>
<li>
<p><strong>pattern string</strong> types are like strings, but they can be executed as Rant patterns. It is declared using a dollar sign in front of a string: <code>$"&lt;noun&gt;"</code>. They can be executed two ways: using a function call - <code>$"&lt;noun&gt;"()</code> - or by being returned from an expression. You can use a concatenation operator like strings.</p>
</li>
<li>
<p><strong>no</strong> is a null value. This means that it is a value that has been <em>explicitly</em> set to null. It's a constant: <code>x = no</code>. Why <code>no</code> instead of null? It's funny.</p>
</li>
<li>
<p><strong>undefined</strong> is a value that hasn't been set yet. In Richard, this type is identified by the constant <code>???</code> - that is, if you set something to undefined (why?), it would look like this: <code>x = ???</code></p>
</li>
</ul>
<h3>Statements</h3>
<p>There are a few control flow statements in Richard.</p>
<p><strong>if</strong> statements, along with their companion <strong>else</strong> statements, are a way of conditionally executing a specified block of code. You use them like you do in any other language:</p>
<div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;It&#39;s true!&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;This should never happen.&quot;</span>
<span class="p">}</span>
</pre></div>


<p><strong>while</strong> statements are, again, the same as they are in every language since C:</p>
<div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">while</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">x</span><span class="o">--</span><span class="p">;</span>
    <span class="n">Output</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">Convert</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">~</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p><strong>for</strong> statements are different! They're actually <code>for..in</code> statements, like in Javascript. The reasoning is that there are very few times that you ever need to use a for loop in a way that's not just iterating over something from beginning to end, and if you want to do that, you can use a while loop.</p>
<p>You can use a <code>for..in</code> loop to iterate over lists or objects:</p>
<div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="s">&quot;this&quot;</span><span class="p">,</span> <span class="s">&quot;is&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="s">&quot;string&quot;</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Output</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">~</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">y</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;key1&quot;</span><span class="o">:</span> <span class="s">&quot;string&quot;</span><span class="p">,</span>
    <span class="s">&quot;key2&quot;</span><span class="o">:</span> <span class="s">&quot;another string&quot;</span>
<span class="p">};</span>

<span class="k">for</span><span class="p">(</span><span class="n">k</span> <span class="n">in</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Output</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">~</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>As you can tell, the key is returned, not the object. For arrays, this will be the index.</p>
<p>You can <code>break</code> out of both kinds of loops.</p>
<h2>Standard Library</h2>
<p>Richard currently doesn't have a very robust standard library, though we'll be adding to it constantly.</p>
<p>For now, there's two types of standard library functions: properties and global objects. Properties are created on a specific type of object, and can be used on any type of that object. For example, <code>string</code> types have a <code>length</code> property, and <code>list</code> types have a <code>last</code> property. Global objects are global Richard key/value objects which have properties of their own. For example, there's a <code>Math</code> global object, which has a property <code>PI</code> which returns the mathematical constant Pi. It also has functions like <code>sin</code> and <code>atan2</code>.</p>
<p>There isn't documentation for the standard library yet (I haven't written the extension for Constitution), but every function has tests, and you can take a look at those.</p>
<h2>Sample Program</h2>
<p>I'm too lazy to write my own sample program, but here's one Berkin wrote:</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="kd">var</span> <span class="nx">Select</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="err">#</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">condition</span><span class="p">(</span><span class="nx">current</span><span class="p">))</span>
    <span class="nx">where</span><span class="o">:</span> <span class="p">(</span><span class="nx">lst</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">lst</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nx">lst</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
          <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">lst</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="err">#</span> <span class="nx">accumulator</span><span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span>
    <span class="nx">concat</span><span class="o">:</span> <span class="p">(</span><span class="nx">lst</span><span class="p">,</span> <span class="nx">accumulator</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&quot;</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">lst</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">accumulator</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">lst</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">buffer</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">Select</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span>
    <span class="nx">Select</span><span class="p">.</span><span class="nx">where</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
    <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">current</span> <span class="o">~=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="nx">current</span> <span class="o">~=</span> <span class="nx">next</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">current</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>


<p>It's an implementation of some Linq-inspired features in Richard. I'll probably add some of these (where / filter, map / select, reduce, etc) into the Richard standard library before release.</p>
<h2>In Conclusion</h2>
<p>Richard is currently really buggy, but it's still usable! If you find any bugs, please add a test for it! We're especially concerned about "white" exceptions, i.e. exceptions that aren't RantRuntimeExceptions or RantCompilerExceptions.</p>
  </div><!-- /.entry-content -->
</section>

<div id="disqus_thread"></div>
<script type="text/javascript">
	this.page = {};
    var disqus_shortname = 'commiesprogblog'; 
    var disqus_config = function() {
    	this.page.url = "http://" + window.location.hostname + window.location.pathname;
    	this.page.identifier = this.page.url;
    	this.page.title = 'Richard 1.0 - Rant's New Scripting Engine';
    }
    (function() {
        var d = document, s = d.createElement('script');
        
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js'; 
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
    <footer id="contentinfo" class="body container">
        <address id="about" class="vcard body">
            <p>
                Written by <span class="fn">Andrew Rogers</span> (<span class="nickname">cpancake</span>) - contact me at <span class="email">andrew@<span class="email-obscure">lame-spam-bots-</span><span class="email-dont-obscure">anime-nigh</span>t.com</span>
            </p>
            <p>
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
            </p>
        </address><!-- /#about -->
    </footer><!-- /#contentinfo -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-51284727-1', 'cpancake.github.io');
        ga('send', 'pageview');
    </script>
</body>
</html>